<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frame Wars : A 4‑Player Guess The Frame Game</title>
  <style>
    :root{ --bg:#0b1020;--card:#121935;--muted:#93a1c6;--text:#eaf0ff;--accent:#6ae3ff;--good:#2dd4bf;--bad:#f87171;--primary:#8b5cf6;--yellow:#fde047; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;background:radial-gradient(1200px 800px at 80% -10%, #1d2758 0%, #0b1020 55%);}    
    a{color:var(--accent)}
    .wrap{max-width:1200px;margin:0 auto;padding:20px 16px 80px;color:var(--text)}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{display:flex;align-items:center;gap:10px}
    .title h1{margin:0;font-size:20px;letter-spacing:.2px}
    .title .pill{font-size:12px;background:rgba(255,255,255,.08);padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.1);color:var(--muted)}
    .grid{display:grid;gap:14px}
    .grid.cols-2{grid-template-columns:320px 1fr}
    @media (max-width:900px){.grid.cols-2{grid-template-columns:1fr}}
    .pane{padding:16px}
    .pane h2{margin:0 0 8px;font-size:16px;color:var(--muted);font-weight:600}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input[type=text], input[type=number], textarea{width:100%;padding:12px 12px;border-radius:12px;background:#0d1330;border:1px solid rgba(255,255,255,.1);color:#fff}
    button{appearance:none;border:0;border-radius:14px;padding:12px 16px;font-weight:700;letter-spacing:.2px;cursor:pointer;color:#0b1020;background:linear-gradient(180deg,#8b5cf6,#5b21b6);box-shadow:0 8px 20px rgba(91,33,182,.45)}
    button.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.15)}
    button.flat{background:#1e293b;color:#e5edff;border:1px solid rgba(255,255,255,.08)}
    button.good{background:linear-gradient(180deg,#34d399,#059669)}
    button.bad{background:linear-gradient(180deg,#f87171,#dc2626)}
    button.warn{background:linear-gradient(180deg,#fde047,#eab308);color:#1f2937}
    .badge{padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-size:12px;color:var(--muted)}
    .players{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (min-width:900px){.players{grid-template-columns:repeat(2,minmax(0,1fr))}}
    .p-card{padding:12px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);position:relative}
    .p-card .name{font-weight:700}
    .p-card .score{font-size:28px;font-weight:800}
    .p-card.umpire{outline:2px dashed var(--accent);}
    .p-card .tag{position:absolute;right:10px;top:10px;font-size:11px;padding:3px 8px;border-radius:999px;background:rgba(106,227,255,.18);color:#bfefff;border:1px solid rgba(106,227,255,.4)}
    .question{display:flex;flex-direction:column;gap:10px}
    .q-view{position:relative;background:#0a0f25;border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden;min-height:60vh;display:flex;align-items:center;justify-content:center}
    .q-view img{max-width:100%;max-height:75vh;display:block;transition:filter .2s ease}
    .q-view.blurred img{filter:blur(16px) brightness(.75)}
    .q-view .cover{position:absolute;inset:0;display:grid;place-items:center;color:#cfe3ff;font-weight:800;background:rgba(11,16,32,.25);backdrop-filter:blur(2px)}
    .watermark{position:absolute;inset:auto 12px 12px auto;font-size:11px;opacity:.55}
    .progress{width:84px;height:84px;background:conic-gradient(var(--yellow) var(--deg,0deg), rgba(255,255,255,.08) 0);border-radius:50%;display:grid;place-items:center;border:1px solid rgba(255,255,255,.08)}
    .progress span{display:block;background:#0a0f25;border:1px solid rgba(255,255,255,.08);border-radius:50%;width:64px;height:64px;display:grid;place-items:center;font-weight:800}
    .mini{font-size:11px;color:var(--muted)}
    .sep{height:1px;background:rgba(255,255,255,.08);margin:12px 0}
    .footer{position:fixed;left:0;right:0;bottom:0;padding:10px 16px;background:linear-gradient(180deg, rgba(11,16,32,0), rgba(11,16,32,.85));backdrop-filter:blur(6px);}
    .footer .inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:10px;justify-content:space-between}
    .hidden{display:none}
    dialog{border:1px solid rgba(255,255,255,.12);background:#0b122d;color:var(--text);border-radius:16px;max-width:760px;width:96%;padding:0}
    dialog .hd{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;justify-content:space-between}
    dialog .bd{padding:14px 16px}
    .kbd{font:600 12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0b1020;padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.1)}
    .pill-sel{display:flex;gap:8px;flex-wrap:wrap}
    .pill-sel button{background:#0d1330;border:1px solid rgba(255,255,255,.12);color:#cfe3ff}
    .pill-sel button.active{background:#1d2a78;color:#fff;border-color:#3b82f6}
    .dim{opacity:.6}
    .list{display:grid;gap:10px}
    .list .item{background:#0a0f25;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px}
    .item-head{display:flex;align-items:center;justify-content:space-between;gap:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3l2.39 4.84L20 8.76l-3.5 3.41.83 4.83L12 15.9l-5.33 2.8.83-4.83L4 8.76l5.61-.92L12 3z" stroke="url(#g)" stroke-width="1.2"/><defs><linearGradient id="g" x1="0" y1="0" x2="24" y2="24"><stop stop-color="#6ae3ff"/><stop offset="1" stop-color="#8b5cf6"/></linearGradient></defs></svg>
        <h1><strong>Frame Wars</strong> : <span class="dim">A 4‑Player Guess The Frame Game</span></h1>
        <span class="pill">15sec per question | +10p player | +15p umpire</span>
      </div>
      <div class="row">
        <button class="flat" id="howBtn">How it works</button>
        <button class="ghost" id="settingsBtn" title="Edit players, timer, rotation">Settings</button>
      </div>
    </header>

    <div class="grid cols-2" id="setupView">
      <section class="card pane">
        <h2>Players</h2>
        <div class="players" id="playersForm"></div>
        <div class="sep"></div>
        <div class="row">
          <label class="badge">Umpire rotation</label>
          <div class="pill-sel" id="rotationSel"></div>
        </div>
        <div class="row" style="margin-top:10px">
          <div style="flex:1"><label class="badge">Timer (seconds)</label><input type="number" id="timerInput" value="15" min="5" max="90"/></div>
          <div style="flex:1"><label class="badge">Questions / round</label><div class="p-card" style="padding:10px 12px">7</div></div>
        </div>
        <div class="row" style="margin-top:12px">
          <button id="startBtn">Start game</button>
        </div>
      </section>
      <section class="card pane">
        <h2>Rounds</h2>
        <div class="list" id="roundList"></div>
        <div class="sep"></div>
        <p class="mini">Tip: Umpire can add or pick questions on the fly in the round screen.</p>
      </section>
    </div>

    <section id="gameView" class="hidden">
      <div class="grid cols-2">
        <!-- LEFT: round controls + players & buzz -->
        <div class="card pane">
          <h2>Round</h2>
          <div class="row" style="justify-content:space-between">
            <div>
              <div class="badge">Category</div>
              <div style="font-size:20px;font-weight:800" id="roundName">—</div>
              <div class="mini" id="qProgress">Q — / —</div>
            </div>
            <div class="progress" id="progress"><span id="tLeft">15</span></div>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="warn" id="startQBtn">Start <span class="mini">(space)</span></button>
            <button class="ghost" id="revealBtn">Reveal answer</button>
          </div>
          <div class="sep"></div>
          <h2>Players & Buzz</h2>
          <div class="players" id="scoreBoard"></div>
          <div class="sep"></div>
          <div id="buzzBar"></div>
          <div class="row" style="margin-top:10px">
            <button id="prevBtn" class="ghost">◀ Prev</button>
            <button id="nextBtn">Next ▶</button>
          </div>
        </div>

        <!-- RIGHT: big centered image & actions -->
        <div>
          <div class="card pane question">
            <div class="q-view blurred" id="qView">
              <div class="qtext dim">Press <span class="kbd">Start</span> to show clearly</div>
              <div class="watermark">Umpire: <span id="umpireTag">—</span></div>
            </div>
          </div>
          <div class="row" style="margin-top:10px; justify-content:flex-start">
            <div class="badge">Award points</div>
          </div>
          <div class="row" style="margin-top:8px;flex-wrap:wrap">
            <button class="flat" id="umpireCorrectBtn">Umpire got it (+15)</button>
            <button class="bad" id="skipBtn">Skip</button>
          </div>
        </div>
      </div>
    </section>

    <section id="endView" class="hidden">
      <div class="card pane">
        <h2>Final Leaderboard</h2>
        <div class="players" id="finalBoard"></div>
        <div class="row" style="margin-top:12px">
          <button id="playAgainBtn">Play again</button>
          <button class="flat" id="backHomeBtn">Back to setup</button>
        </div>
      </div>
    </section>

    <div class="footer">
      <div class="inner mini">Made for GitHub Pages · Single HTML file · <span id="saveHint">Scores auto‑save to your browser</span></div>
    </div>
  </div>

  <dialog id="howDlg">
    <div class="hd"><strong>How it works</strong><button class="ghost" onclick="this.closest('dialog').close()">✕</button></div>
    <div class="bd">
      <ol>
        <li><strong>Enter 4 players</strong> and choose umpire rotation (each round, one different umpire).</li>
        <li><strong>Four rounds:</strong> 1) Hollywood (frames/pics), 2) Indian (frames/pics), 3) Dialogues (text), 4) Eyes (frames/pics).</li>
        <li><strong>15s timer</strong> per question. First correct among the three non‑umpire players gets <strong>+10</strong>.</li>
        <li>If no player gets it, the <strong>umpire may answer</strong>. If correct, umpire gets <strong>+15</strong>.</li>
        <li>Images now appear <em>blurred</em> when you navigate. Press <strong>Start</strong> to unblur and start the timer. Answers only show via <strong>Reveal answer</strong>.</li>
      </ol>
    </div>
  </dialog>

  <dialog id="settingsDlg">
    <div class="hd"><strong>Edit players / add quick question</strong><button class="ghost" onclick="this.closest('dialog').close()">✕</button></div>
    <div class="bd">
      <div class="grid cols-2">
        <div>
          <h3>Players</h3>
          <div id="playersInline"></div>
        </div>
        <div>
          <h3>Quick add question (current round)</h3>
          <div class="row"><input id="quickAnswer" type="text" placeholder="Answer (movie or actor)"/></div>
          <div class="row"><textarea id="quickPrompt" rows="3" placeholder="Paste image URL or dialogue text"></textarea></div>
          <div class="row"><button id="quickAddBtn">Add to current round</button></div>
          <p class="mini">Tip: For <em>image</em> rounds, paste a direct image URL (PNG/JPEG). For <em>dialogues</em> round, enter the quote in the text box.</p>
        </div>
      </div>
    </div>
  </dialog>

  <script>
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const store = {
    players:[{name:'Player 1',score:0},{name:'Player 2',score:0},{name:'Player 3',score:0},{name:'Player 4',score:0}],
    rotation:'auto', timerSec:15, qPerRound:7, rounds:[], cur:{roundIdx:0,qIdx:0,umpireIdx:0,started:false,timeLeft:15,interval:null,isBlurred:true}
  };

  const LS_KEY='gtf_state_v1';
  async function tryFetchPack(){ try{ const r=await fetch('./pack.json',{cache:'no-store'}); if(r.ok){ return await r.json(); } }catch(e){} return null; }
  function save(){ const toSave = JSON.stringify({players:store.players, rotation:store.rotation, timerSec:store.timerSec, qPerRound:store.qPerRound, rounds:store.rounds}); localStorage.setItem(LS_KEY, toSave); }
  function load(){ const raw=localStorage.getItem(LS_KEY); if(raw){ try{ const data=JSON.parse(raw); Object.assign(store, data); }catch(e){} } store.qPerRound = 7; }

  function renderSetup(){
    $('#setupView').classList.remove('hidden'); $('#gameView').classList.add('hidden'); $('#endView').classList.add('hidden');
    const pf=$('#playersForm'); pf.innerHTML='';
    store.players.forEach((p,i)=>{ const d=document.createElement('div'); d.className='p-card'; d.innerHTML=`<div class="row"><span class="badge">P${i+1}</span></div><input type="text" value="${p.name}" data-idx="${i}" class="nameInput"/>`; pf.appendChild(d); });
    pf.querySelectorAll('.nameInput').forEach(inp=> inp.addEventListener('input', e=>{ const i=+inp.dataset.idx; store.players[i].name=inp.value; save(); renderScore(); renderBuzzbar(); }));
    const rot=$('#rotationSel'); rot.innerHTML=''; ['auto','manual'].forEach(r=>{ const b=document.createElement('button'); b.className='flat'+(store.rotation===r?' active':''); b.textContent=r; b.onclick=()=>{store.rotation=r; save(); renderRotationSel();}; rot.appendChild(b); });
    renderRotationSel();
    $('#timerInput').value = store.timerSec;
    const rl=$('#roundList'); rl.innerHTML=''; store.rounds.forEach((r,ri)=>{ const it=document.createElement('div'); it.className='item'; it.innerHTML=`<div class="item-head"><div><strong>${ri+1}. ${r.name}</strong> <span class="badge">${r.type}</span></div><div class="mini">${r.items.length} items</div></div>`; rl.appendChild(it); });
    const pi=$('#playersInline'); pi.innerHTML=''; store.players.forEach((p,i)=>{ const row=document.createElement('div'); row.className='row'; row.innerHTML=`<span class="badge">P${i+1}</span><input type="text" value="${p.name}" data-idx="${i}"/>`; pi.appendChild(row); });
    pi.querySelectorAll('input').forEach(inp=> inp.addEventListener('input', e=>{ const i=+inp.dataset.idx; store.players[i].name=inp.value; save(); renderScore(); renderBuzzbar(); $('#playersForm').querySelectorAll('.nameInput')[i].value=inp.value; }));
  }
  function renderRotationSel(){ $$('#rotationSel button').forEach(b=> b.classList.remove('active')); $$('#rotationSel button').find(b=> b.textContent===store.rotation)?.classList.add('active'); }
  function initGame(){ store.cur.roundIdx=0; store.cur.qIdx=0; store.cur.started=false; store.cur.umpireIdx=0; store.cur.isBlurred=true; store.players.forEach(p=>p.score=0); save(); renderGame(); }
  function renderGame(){ $('#setupView').classList.add('hidden'); $('#gameView').classList.remove('hidden'); $('#endView').classList.add('hidden'); const r=store.rounds[store.cur.roundIdx]; $('#roundName').textContent=`${store.cur.roundIdx+1}. ${r.name}`; $('#umpireTag').textContent=store.players[store.cur.umpireIdx].name; const totalQ=Math.min(store.qPerRound, r.items.length); $('#qProgress').textContent=`Q ${Math.min(store.cur.qIdx+1,totalQ)} / ${totalQ}`; renderQuestion(); renderScore(); renderBuzzbar(); }
  function renderScore(){ const sb=$('#scoreBoard'); sb.innerHTML=''; store.players.forEach((p,i)=>{ const d=document.createElement('div'); d.className='p-card'+(i===store.cur.umpireIdx?' umpire':''); d.innerHTML=`<div class="tag">${i===store.cur.umpireIdx?'UMPIRE':'PLAYER'}</div><div class="name">${p.name}</div><div class="score" data-score="${i}">${p.score}</div>`; sb.appendChild(d); }); const fb=$('#finalBoard'); if(fb){ fb.innerHTML=''; [...store.players].sort((a,b)=>b.score-a.score).forEach((p)=>{ const d=document.createElement('div'); d.className='p-card'; d.innerHTML=`<div class="name">${p.name}</div><div class="score">${p.score}</div>`; fb.appendChild(d); }) } }
  function renderBuzzbar(){ const bb=$('#buzzBar'); bb.innerHTML=''; store.players.forEach((p,i)=>{ if(i===store.cur.umpireIdx) return; const b=document.createElement('button'); b.className='flat'; b.style.margin='6px 6px 0 0'; b.textContent=`✔ ${p.name} (+10)`; b.onclick=()=>awardPlayer(i,10); bb.appendChild(b); }); }
  function renderQuestion(){ const r=store.rounds[store.cur.roundIdx]; const items=r.items; const totalQ=Math.min(store.qPerRound, items.length); const idx=Math.min(store.cur.qIdx, totalQ-1); const q=items[idx]; $('#qProgress').textContent=`Q ${idx+1} / ${totalQ}`; const view=$('#qView'); view.classList.add('blurred'); view.innerHTML=''; if(r.type==='text'){ const el=document.createElement('div'); el.className='qtext'; el.textContent=q.text||'(no text)'; view.appendChild(el); } else { const img=document.createElement('img'); img.alt='Question image'; img.loading='eager'; img.src=q.imageUrl||''; view.appendChild(img); } const wm=document.createElement('div'); wm.className='watermark'; wm.innerHTML=`Umpire: <span id="umpireTag">${store.players[store.cur.umpireIdx].name}</span>`; view.appendChild(wm); const cover=document.createElement('div'); cover.className='cover'; cover.textContent='Blurred — Press Start'; view.appendChild(cover); store.cur.isBlurred=true; }
  function nextQuestion(){ const r=store.rounds[store.cur.roundIdx]; const totalQ=Math.min(store.qPerRound, r.items.length); if(store.cur.qIdx<totalQ-1){ store.cur.qIdx++; store.cur.isBlurred=true; renderGame(); } else { nextRound(); } }
  function prevQuestion(){ if(store.cur.qIdx>0){ store.cur.qIdx--; store.cur.isBlurred=true; renderGame(); } }
  function nextRound(){ if(store.cur.roundIdx<store.rounds.length-1){ store.cur.roundIdx++; store.cur.qIdx=0; store.cur.isBlurred=true; if(store.rotation==='auto'){ store.cur.umpireIdx=(store.cur.umpireIdx+1)%store.players.length; } renderGame(); } else { endGame(); } }
  function endGame(){ $('#setupView').classList.add('hidden'); $('#gameView').classList.add('hidden'); $('#endView').classList.remove('hidden'); renderScore(); save(); }
  function awardPlayer(i,pts){ if(i===store.cur.umpireIdx) return; store.players[i].score+=pts; save(); renderScore(); nextQuestion(); }
  function awardUmpire(pts){ store.players[store.cur.umpireIdx].score+=pts; save(); renderScore(); nextQuestion(); }

  function resetTimer(){ clearInterval(store.cur.interval); store.cur.started=false; store.cur.timeLeft=store.timerSec; updateProgress(1); $('#tLeft').textContent=store.cur.timeLeft; setProgressDeg(0); }
  function setProgressDeg(deg){ $('#progress').style.setProperty('--deg', deg+'deg'); }
  function updateProgress(frac){ setProgressDeg(360*frac); }
  function startTimer(){ if(store.cur.started) return; store.cur.started=true; const total=store.timerSec; const t0=Date.now(); tone(880,0.08); const v=$('#qView'); v.classList.remove('blurred'); const cover=v.querySelector('.cover'); if(cover) cover.remove(); store.cur.interval=setInterval(()=>{ const elapsed=(Date.now()-t0)/1000; let left=Math.max(0, Math.ceil(total - elapsed)); store.cur.timeLeft=left; $('#tLeft').textContent=left; const frac=Math.min(1, elapsed/total); updateProgress(frac); if(left<=0){ clearInterval(store.cur.interval); store.cur.started=false; tone(220,0.25); } }, 100); }
  let actx; function tone(freq,dur){ try{ actx=actx||new (window.AudioContext||window.webkitAudioContext)(); const o=actx.createOscillator(); const g=actx.createGain(); o.connect(g); g.connect(actx.destination); o.frequency.value=freq; g.gain.setValueAtTime(0.02, actx.currentTime); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+dur); o.stop(actx.currentTime+dur); }catch(e){} }

  // Buttons
  $('#howBtn').onclick=()=>$('#howDlg').showModal();
  $('#settingsBtn').onclick=()=>$('#settingsDlg').showModal();
  $('#startBtn').onclick=()=>{ store.timerSec=+$('#timerInput').value||15; store.qPerRound=7; save(); initGame(); };
  $('#startQBtn').onclick=startTimer;
  $('#revealBtn').onclick=()=>{
    const r=store.rounds[store.cur.roundIdx];
    const q=r.items[Math.min(store.cur.qIdx, Math.min(store.qPerRound, r.items.length)-1)];
    alert('Answer: '+(q.answer||'(not set)'));
  };
  $('#prevBtn').onclick=prevQuestion; $('#nextBtn').onclick=nextQuestion; $('#skipBtn').onclick=nextQuestion;
  $('#umpireCorrectBtn').onclick=()=> awardUmpire(15);

  // Quick add
  $('#quickAddBtn').onclick=()=>{ const r=store.rounds[store.cur.roundIdx]; if(!r){ alert('No round in progress.'); return; } const ans=$('#quickAnswer').value.trim(); const prm=$('#quickPrompt').value.trim(); if(!ans||!prm){ alert('Need both answer and prompt.'); return; } if(r.type==='text') r.items.push({text:prm, answer:ans}); else r.items.push({imageUrl:prm, answer:ans}); save(); $('#quickAnswer').value=''; $('#quickPrompt').value=''; renderSetup(); alert('Added to current round.'); };

  // Keyboard
  window.addEventListener('keydown', (e)=>{ if(e.key===' '){ e.preventDefault(); startTimer(); } if(e.key==='ArrowRight') nextQuestion(); if(e.key==='ArrowLeft') prevQuestion(); });

  // Manual rotation (click a player card)
  $('#scoreBoard').addEventListener('click', (e)=>{ const card=e.target.closest('.p-card'); if(!card) return; const idx=[...$('#scoreBoard').children].indexOf(card); if(store.rotation==='manual'){ store.cur.umpireIdx=idx; renderScore(); renderBuzzbar(); $('#umpireTag').textContent=store.players[idx].name; } });

  // Inputs
  $('#timerInput').addEventListener('input', ()=>{ store.timerSec=+$('#timerInput').value||15; save(); $('#tLeft').textContent=store.timerSec; });

  (async function boot(){ const remote=await tryFetchPack(); store.rounds=(remote&&remote.rounds)?remote.rounds:[]; load(); renderSetup(); })();
  </script>
</body>
</html>
